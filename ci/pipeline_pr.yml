---
resource_types:
- name: pull-request
  type: docker-image
  source:
    repository: teliaoss/github-pr-resource
    disable_forks: false
    check_every: 1h
    webhook_token: ooshiecalee4eaghi8eiweM5ciejaisu

resources:
  - name: pretalx
    type: pull-request
    webhook_token: (( webhook-token ))
    source:
      repository: rixx/pretalx
      access_token: (( github-access-token ))

jobs:
  - name: test
    public: true
    plan:
      - get: pretalx
        trigger: true
        version: every
      - put: pretalx
        params:
          path: pretalx
          status: pending
      - task: Run tests
        file: pretalx/ci/pretalx-tests.yml
        vars:
          - codecov: push
          - python-version: 3.7
    on_failure:
      put: pretalx
      params:
        path: pretalx
        status: failure
  - name: lint
    public: true
    plan:
      - get: pretalx
        trigger: true
        version: every
      - task: Run lint
        file: pretalx/ci/pretalx-lint.yml
    on_failure:
      put: pretalx
      params:
        path: pretalx
        status: failure
  - name: docs
    public: true
    plan:
      - get: pretalx
        trigger: true
        version: every
      - task: build docs
        file: pretalx/ci/pretalx-docs.yml
    on_failure:
      put: pretalx
      params:
        path: pretalx
        status: failure
  - put: pretalx
    params:
      path: pretalx
      status: success
